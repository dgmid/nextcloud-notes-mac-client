{"version":3,"sources":["main.js"],"names":["app","BrowserWindow","ipcMain","protocol","webContents","require","url","path","dialog","Store","log","marked","removeMarkdown","win","loginFlow","prefs","store","name","defaults","windowBounds","width","height","x","y","loginCredentials","server","username","password","appInterface","sidebar","selected","categories","appSettings","sortby","orderby","zoom","cursor","spellcheck","showcats","ordercats","catcount","nocertificate","stopwords","stemming","list","exportPath","getPath","createWindow","get","saveWindowBounds","set","getBounds","show","titleBarStyle","minWidth","minHeight","vibrancy","webPreferences","devTools","preload","join","__dirname","nodeIntegration","icon","setSheetOffset","loadURL","format","pathname","slashes","once","on","quit","error","event","killed","info","registerFileProtocol","request","split","user","replace","pass","close","send","certificate","callback","preventDefault","i18n","showErrorBox","t","process","err","origin","message","resizable","minimizable","maximizable","backgroundColor","userAgent","extraHeaders","getAllWebContents","forEach","wc"],"mappings":"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","file":"../main.min.js","sourcesContent":["'use strict'\n\nconst {app, BrowserWindow, ipcMain, protocol, webContents} = require('electron')\nconst url\t\t= require( 'url' ) \nconst path\t\t= require( 'path' )\nconst dialog\t= require( 'electron' ).dialog\nconst Store\t\t= require( 'electron-store' )\nconst log\t\t= require( 'electron-log' )\n\nconst marked \t\t\t= require( 'marked' )\nconst removeMarkdown\t= require( 'remove-markdown' )\n\nlet win,\n\tloginFlow,\n\tprefs = null\n\nlet store = new Store({\n\tname: 'config',\n\tdefaults: {\n\t\t\n\t\twindowBounds: {\n\t\t\t\n\t\t\twidth: 1000,\n\t\t\theight: 680,\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t},\n\t\t\n\t\tloginCredentials: {\n\t\t\t\n\t\t\tserver: '',\n\t\t\tusername: '',\n\t\t\tpassword: ''\n\t\t},\n\t\t\n\t\tappInterface: {\n\t\t\t\n\t\t\tsidebar: null,\n\t\t\tselected: null,\n\t\t\tcategories: true\n\t\t},\n\t\t\n\t\tappSettings: {\n\t\t\t\n\t\t\tsortby: 'modified',\n\t\t\torderby: 'desc',\n\t\t\tzoom: '10',\n\t\t\tcursor: 'start',\n\t\t\tspellcheck: true,\n\t\t\tshowcats: true,\n\t\t\tordercats: 'asc',\n\t\t\tcatcount: false,\n\t\t\tnocertificate: false,\n\t\t\tstopwords: false,\n\t\t\tstemming: false\n\t\t},\n\t\t\n\t\tcategories: {\n\t\t\t\n\t\t\tselected: '##all##',\n\t\t\tlist: null\n\t\t},\n\t\t\n\t\texportPath: app.getPath('desktop')\n\t}\n})\n\n\n\nfunction createWindow() {\n\t\n\tlet { x, y, width, height } = store.get('windowBounds')\n\t\n\twin = new BrowserWindow({\n\t\tshow: false,\n\t\tx: x,\n\t\ty: y,\n\t\twidth: width,\n\t\theight: height,\n\t\ttitleBarStyle: 'hidden',\n\t\tminWidth: 800,\n\t\tminHeight: 372,\n\t\tvibrancy: 'sidebar',\n\t\twebPreferences: {\n\t\t\tdevTools: true,\n\t\t\tpreload: path.join(__dirname, './preload.min.js'),\n\t\t\tnodeIntegration: true,\n\t\t},\n\t\ticon: path.join(__dirname, '../assets/icon/Icon.icns')\n\t})\n\t\n\twin.setSheetOffset( 23 )\n\t\n\tfunction saveWindowBounds() {\n\t\t\n\t\tstore.set('windowBounds', win.getBounds())\n\t}\n\t\n\twin.loadURL(url.format ({ \n\t\t\n\t\tpathname: path.join(__dirname, '../html/app.html'), \n\t\tprotocol: 'file:', \n\t\tslashes: true \n\t}))\n\t\n\twin.once('ready-to-show', () => {\n\t\t\n\t\twin.show()\n\t\t//win.webContents.toggleDevTools()\n\t})\n\t\n\twin.on('resize', saveWindowBounds)\n\twin.on('move', saveWindowBounds)\n\t\n\twin.on('closed', () => {\n\t\t\n\t\tapp.quit()\n\t})\n\t\n\twin.webContents.on('did-fail-load', () => {\n    \t\n\t\tlog.error( `main window did not load` )\n\t})\n\t\n\twin.webContents.on( 'crashed', ( event, killed ) => {\n\t\t\n\t\tlog.info( `main window has crashed:` )\n\t\tlog.error( event )\n\t})\n\t\n\twin.on( 'unresponsive', () => {\n\t\t\n\t\tlog.info( `main window is not responding…` )\n\t})\n\t\n\twin.on( 'responsive', () => {\n\t\t\n\t\tlog.info( `main window is responding` )\n\t})\n\t\n\tprotocol.registerFileProtocol('nc', (request) => {\n\t\t\n\t\tif( request.url ) {\n\t\t\n\t\t\tconst url = request.url.split( '&' )\n\t\t\t\n\t\t\tconst \tuser = url[1].replace('user:', ''),\n\t\t\t\t\tpass = url[2].replace('password:', '')\n\t\t\t\n\t\t\tstore.set( 'loginCredentials.username', user )\n\t\t\tstore.set( 'loginCredentials.password', pass )\n\t\t\t\n\t\t\tloginFlow.close()\n\t\t\t\n\t\t\twin.webContents.send('close-login-modal', 'close-login-modal')\n\t\t\twin.webContents.send('reload-sidebar', 'login')\n\t\t\t\n\t\t} else {\n\t\t\t\n\t\t\tlog.error('Failed to register nc protocol')\n\t\t}\n\t})\n\t\n\trequire( './menu-app.min' )\n\trequire( './menu-sidebar.min' )\n\trequire( './menu-notes.min' )\n}\n\napp.on('ready', createWindow)\n\n\n\napp.on('certificate-error', (event, webContents, url, error, certificate, callback) => {\n\t\n\tif( store.get('appSettings.nocertificate') ) {\n\t\t\n\t\tlog.info(`certificate ignored`)\n\t\tevent.preventDefault()\n\t\tcallback(true)\n\t\t\n\t} else {\n\t\t\n\t\tconst i18n = require( './i18n.min' )\n\t\t\n\t\tlog.error(error)\n\t\tcallback(false)\n\t\tlet server = store.get( 'loginCredentials.server' )\n\t\t\n\t\tdialog.showErrorBox(\n\t\t\ti18n.t('main:dialog.error.cert.title', 'Your connection is not private'),\n\t\t\t`${error}\\n\\n` +\n\t\t\ti18n.t('main:dialog.error.cert.text', {server: server})\n\t\t)\n\t}\n})\n\n\n\nprocess.on('uncaughtException', (err, origin) => {\n\t\n\tlog.error(`caught exception: ${err}`)\n\tlog.info(`exception origin: ${origin}`)\n})\n\n\n\nipcMain.on('loginflow', (event, message) => {\n\t\n\tloginFlow = new BrowserWindow({\n\t\t\n\t\twidth: 800,\n\t\theight: 600,\n\t\tresizable: false,\n\t\tminimizable: false,\n\t\tmaximizable: false,\n\t\tshow: false,\n\t\ttitleBarStyle: 'hidden',\n\t\tbackgroundColor: '#0082c9',\n\t\twebPreferences: {\n\t\t\tdevTools: true,\n\t\t\tnodeIntegration: false\n\t\t}\n\t})\n\t\n\tloginFlow.loadURL( message + '/index.php/login/flow' , {\n\t\t\n\t\tuserAgent: 'Nextcloud Notes Client - Macintosh',\n\t\textraHeaders: 'OCS-APIRequest: true'\n\t})\n\t\n\tloginFlow.once('ready-to-show', () => {\n\t\t\n\t\tloginFlow.show()\n\t})\n\t\n\tloginFlow.webContents.on('did-fail-load', () => {\n\t\t\n\t\tlog.error( `loginflow window did not load` )\n\t})\n\t\n\tloginFlow.webContents.on( 'crashed', ( event, killed ) => {\n\t\t\n\t\tlog.info( `loginflow window has crashed:` )\n\t\tlog.error( event )\n\t})\n\t\n\tloginFlow.on( 'unresponsive', () => {\n\t\t\n\t\tlog.info( `loginflow window is not responding…` )\n\t})\n\t\n\tloginFlow.on( 'responsive', () => {\n\t\t\n\t\tlog.info( `loginflow window is responding` )\n\t})\n})\n\n\n\napp.on('open-prefs', () => {\n\t\n\tif( prefs === null ) {\n\t\t\n\t\tprefs = new BrowserWindow({\n\t\t\t\n\t\t\twidth: 548,\n\t\t\theight: 454,\n\t\t\tresizable: false,\n\t\t\tminimizable: false,\n\t\t\tmaximizable: false,\n\t\t\tshow: false,\n\t\t\ttitleBarStyle: 'hidden',\n\t\t\tvibrancy: 'under-window',\n\t\t\twebPreferences: {\n\t\t\t\tdevTools: true,\n\t\t\t\tpreload: path.join(__dirname, './preload.min.js'),\n\t\t\t\tnodeIntegration: true\n\t\t\t},\n\t\t})\n\t\t\n\t\tprefs.loadURL(url.format ({ \n\t\t\t\n\t\t\tpathname: path.join(__dirname, '../html/prefs.html'), \n\t\t\tprotocol: 'file:', \n\t\t\tslashes: true \n\t\t}))\n\t\t\n\t\tprefs.once('ready-to-show', () => {\n\t\t\t\n\t\t\tprefs.show()\n\t\t})\n\t\t\n\t\tprefs.webContents.on('did-fail-load', () => {\n\t\t\t\n\t\t\tlog.error( `prefs window did not load` )\n\t\t})\n\t\t\n\t\tprefs.webContents.on( 'crashed', ( event, killed ) => {\n\t\t\t\n\t\t\tlog.info( `prefs window has crashed:` )\n\t\t\tlog.error( event )\n\t\t})\n\t\t\n\t\tprefs.on( 'unresponsive', () => {\n\t\t\t\n\t\t\tlog.info( `prefs window is not responding…` )\n\t\t})\n\t\t\n\t\tprefs.on( 'responsive', () => {\n\t\t\t\n\t\t\tlog.info( `prefs window is responding` )\n\t\t})\n\t\t\n\t\tprefs.on('close', () => {\n\t\t\tprefs = null\n\t\t})\n\t}\n})\n\n\n\nipcMain.on('new-category', (event, message) => {\n\t\n\twin.webContents.send('context-category', message)\n})\n\n\nipcMain.on('reload-sidebar', (event, message) => {\n\t\n\twin.webContents.send('reload-sidebar', message)\n})\n\n\nipcMain.on('set-zoom-slider', (event, message) => {\n\t\n\twin.webContents.send('set-zoom-slider', message)\n})\n\n\nipcMain.on('update-theme', (event, message) => {\n\t\n\twebContents.getAllWebContents().forEach( wc => {\n\t\t\n\t\twc.send('set-theme', message)\n\t})\n})\n\n\nipcMain.on('error-in-render', function(event, message) {\n    \n\tlog.error(`exception in render process:`)\n\tlog.info (message)\n})\n"]}